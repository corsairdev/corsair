---
title: Plugins
description: Extend Corsair with third-party integrations and business logic
---

import { Callout } from 'fumadocs-ui/components/callout'

<Callout type="info" title="Plugin System">
  Corsair's plugin system allows you to chain business logic with database operations.
  Plugins are type-safe and integrate seamlessly with your procedures.
</Callout>

## Available Plugins

Corsair currently supports the following plugins (with more in development):

- Slack - Send messages to Slack channels
- Discord - Coming soon
- Resend - Coming soon
- Stripe - Coming soon
- Posthog - Coming soon

## Setup

### 1. Configure Plugins

Add plugin configuration to your `corsair.config.ts`:

```ts title="corsair.config.ts"
import { type CorsairConfig } from 'corsair'
import { db } from './db'

export const config = {
  dbType: 'postgres',
  orm: 'drizzle',
  framework: 'nextjs',
  pathToCorsairFolder: './corsair',
  apiEndpoint: process.env.NEXT_PUBLIC_CORSAIR_API_ROUTE!,
  db: db,
  schema: db._.schema,
  connection: process.env.DATABASE_URL!,
  plugins: {
    slack: {
      token: process.env.SLACK_BOT_TOKEN!,
      channels: {
        'general': 'C01234567',
        'notifications': 'C01234568',
        'errors': 'C01234569',
      },
    },
  },
} satisfies CorsairConfig<typeof db>
```

### 2. Create Plugins Instance

Initialize plugins in your procedure file:

```ts title="corsair/procedure.ts"
import { createCorsairTRPC } from 'corsair'
import { createPlugins } from 'corsair/plugins'
import { config } from '@/corsair.config'

export const plugins = createPlugins(config)

export type DatabaseContext = {
  db: typeof config.db
  schema: Exclude<typeof config.schema, undefined>
  userId?: string
  plugins: typeof plugins
}

const t = createCorsairTRPC<DatabaseContext>()
export const { router, procedure } = t
```

### 3. Pass Plugins to Context

Include plugins in your API route context:

```ts title="app/api/corsair/[...corsair]/route.ts"
import { fetchRequestHandler } from 'corsair'
import { corsairRouter } from '@/corsair/index'
import { db } from '@/db'
import { plugins } from '@/corsair/procedure'

const handler = async (req: Request) => {
  return fetchRequestHandler({
    endpoint: '/api/corsair',
    req,
    router: corsairRouter,
    createContext: () => {
      return {
        userId: '123',
        db,
        schema: db._.schema!,
        plugins,
      }
    },
  })
}

export const GET = handler
export const POST = handler
```

## Using Plugins

### Slack Plugin

Send messages to Slack channels from your mutations:

```ts title="corsair/mutations/send-slack-message.ts"
import { z } from 'corsair'
import { procedure } from '../procedure'

export const sendSlackMessage = procedure
  .input(
    z.object({
      channel: z.string(),
      message: z.string(),
    })
  )
  .mutation(async ({ input, ctx }) => {
    await ctx.plugins.slack.sendMessage({
      channelId: input.channel,
      message: input.message,
    })

    return { success: true }
  })
```

### Combining with Database Operations

Chain plugin actions with database operations:

```ts title="corsair/mutations/create-user-with-notification.ts"
import { z } from 'corsair'
import { procedure } from '../procedure'

export const createUserWithNotification = procedure
  .input(
    z.object({
      name: z.string(),
      email: z.string().email(),
    })
  )
  .mutation(async ({ input, ctx }) => {
    const [user] = await ctx.db
      .insert(ctx.db._.fullSchema.users)
      .values(input)
      .returning()

    await ctx.plugins.slack.sendMessage({
      channelId: 'notifications',
      message: `New user created: ${user.name} (${user.email})`,
    })

    return user
  })
```

## Environment Variables

Add required environment variables for plugins:

```bash title=".env.local"
SLACK_BOT_TOKEN=xoxb-your-bot-token
SLACK_SIGNING_SECRET=your-signing-secret
```

<Callout type="warn" title="Security">
  Never commit API keys or tokens to version control. Always use environment
  variables and add them to your `.gitignore`.
</Callout>

## Creating Custom Plugins

You can create custom plugins by extending the plugin system. More documentation
on custom plugins coming soon.

<Callout type="info" title="Plugin Ecosystem">
  The plugin ecosystem is in early development. If you'd like to request a specific
  integration or contribute a plugin, please open an issue on GitHub.
</Callout>

