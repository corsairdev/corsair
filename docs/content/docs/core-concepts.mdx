---
title: Core Concepts
description: Understanding queries, mutations, and client setup
---

import { Callout } from 'fumadocs-ui/components/callout'

## Procedures

Corsair uses tRPC under the hood. Procedures are the building blocks for queries and mutations.

### Queries

Queries are for fetching data. They use the `.query()` method:

```ts title="corsair/queries/get-all-albums.ts"
import { z } from 'corsair'
import { procedure } from '../procedure'

export const getAllAlbums = procedure
  .input(z.object({}))
  .query(async ({ input, ctx }) => {
    const albums = await ctx.db.select().from(ctx.db._.fullSchema.albums)
    return albums
  })
```

### Mutations

Mutations are for creating, updating, or deleting data. They use the `.mutation()` method:

```ts title="corsair/mutations/create-album.ts"
import { procedure } from '../procedure'
import { z } from 'corsair'

export const createAlbum = procedure
  .input(
    z.object({
      id: z.string(),
      name: z.string(),
      album_type: z.string(),
    })
  )
  .mutation(async ({ input, ctx }) => {
    const [album] = await ctx.db
      .insert(ctx.db._.fullSchema.albums)
      .values({ ...input })
      .returning()

    return album
  })
```

## Client Setup

Create a typed client to use in your components:

```ts title="corsair/client.ts"
import { createCorsairClient, createCorsairHooks } from 'corsair'
import type { CorsairRouter } from '.'

const getBaseUrl = () => {
  if (typeof window !== 'undefined') {
    return window.location.origin
  }
  if (process.env.VERCEL_URL) {
    return `https://${process.env.VERCEL_URL}`
  }
  return `http://localhost:${process.env.PORT || 3000}`
}

const { typedClient } = createCorsairClient<CorsairRouter>({
  url: `${getBaseUrl()}${process.env.NEXT_PUBLIC_CORSAIR_API_ROUTE!}`,
})

const {
  useCorsairQuery,
  useCorsairMutation,
  corsairQuery,
  corsairMutation,
  types,
} = createCorsairHooks<CorsairRouter>(typedClient)

export { useCorsairQuery, useCorsairMutation, corsairQuery, corsairMutation }

export type QueryInputs = typeof types.QueryInputs
export type QueryOutputs = typeof types.QueryOutputs
export type MutationInputs = typeof types.MutationInputs
export type MutationOutputs = typeof types.MutationOutputs
```

## Provider Setup

Wrap your app with `CorsairProvider` in your root layout:

```tsx title="app/layout.tsx"
import { CorsairProvider } from "corsair/client"

export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="en">
      <body>
        <CorsairProvider>{children}</CorsairProvider>
      </body>
    </html>
  )
}
```

## Using Queries

### Server Components

Use `corsairQuery` for server-side data fetching:

```tsx title="app/page.tsx"
import { corsairQuery } from '@/corsair/client'

export default async function Home() {
  const artists = await corsairQuery('get all artists', {})
  const albums = await corsairQuery('get all albums', {})

  return <div>{/* Render data */}</div>
}
```

### Client Components

Use `useCorsairQuery` for client-side data fetching:

```tsx title="components/artist-details.tsx"
'use client'

import { useCorsairQuery } from '@/corsair/client'

export function ArtistDetails({ artistId }: { artistId: string }) {
  const { data, isLoading } = useCorsairQuery(
    'get albums by artist id',
    { artistId },
    { enabled: !!artistId }
  )

  if (isLoading) return <div>Loading...</div>
  
  return <div>{/* Render albums */}</div>
}
```

## Using Mutations

Use `useCorsairMutation` for mutations in client components:

```tsx title="components/create-album-form.tsx"
'use client'

import { useCorsairMutation } from '@/corsair/client'

export function CreateAlbumForm() {
  const mutation = useCorsairMutation('create album')

  const handleSubmit = async (data: any) => {
    await mutation.mutate(data)
  }

  return <form onSubmit={handleSubmit}>{/* Form fields */}</form>
}
```

<Callout type="info" title="Type Safety">
  All queries and mutations are fully typed. TypeScript will autocomplete available operations 
  and validate input/output types.
</Callout>

