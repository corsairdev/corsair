---
title: Project Structure
description: Understanding the Corsair project structure and file organization
---

import { Callout } from 'fumadocs-ui/components/callout'

## Overview

Corsair follows a specific project structure to organize your queries, mutations, and configuration. Understanding this structure helps you navigate your codebase and know which files are managed by Corsair vs. which ones you control.

## Key Paths

Here's the complete file structure for a typical Corsair project:

```
project-root/
├── corsair.config.ts           # Main configuration file
├── corsair/
│   ├── index.ts                # Exports all procedures (your router)
│   ├── procedure.ts            # Base procedure configuration
│   ├── client.ts               # Client-side setup and hooks
│   ├── queries/
│   │   ├── index.ts            # Auto-generated exports (managed by Corsair)
│   │   ├── get-all-albums.ts   # Your query files
│   │   └── get-album-by-id.ts
│   └── mutations/
│       ├── index.ts            # Auto-generated exports (managed by Corsair)
│       ├── create-album.ts     # Your mutation files
│       └── update-album.ts
├── app/
│   └── api/
│       └── corsair/
│           └── [...corsair]/
│               └── route.ts    # API endpoint handler
└── db/
    ├── index.ts                # Database client
    └── schema.ts               # Database schema (source of truth)
```

## File Responsibilities

### User-Managed Files

These files are created and maintained by you:

#### `corsair.config.ts`

Your main configuration file that defines database connection, ORM type, framework, and plugins.

```ts title="corsair.config.ts"
import { type CorsairConfig } from 'corsair'
import { db } from './db'

export const config = {
  dbType: 'postgres',
  orm: 'drizzle',
  framework: 'nextjs',
  pathToCorsairFolder: './corsair',
  apiEndpoint: process.env.NEXT_PUBLIC_CORSAIR_API_ROUTE!,
  db: db,
  schema: db._.schema,
  connection: process.env.DATABASE_URL!,
} satisfies CorsairConfig<typeof db>
```

#### `corsair/procedure.ts`

Defines your tRPC context and base procedure configuration.

```ts title="corsair/procedure.ts"
import { createCorsairTRPC } from 'corsair'
import { config } from '../corsair.config'

export type DatabaseContext = {
  db: typeof config.db
  schema: Exclude<typeof config.schema, undefined>
  userId?: string
}

const t = createCorsairTRPC<DatabaseContext>()
export const { router, procedure } = t
```

#### `corsair/index.ts`

Your main router that combines all queries and mutations.

```ts title="corsair/index.ts"
import { dualKeyOperationsMap } from 'corsair'
import { router } from './procedure'
import * as queries from './queries'
import * as mutations from './mutations'

export const corsairRouter = router({
  ...dualKeyOperationsMap(queries),
  ...dualKeyOperationsMap(mutations),
})

export type CorsairRouter = typeof corsairRouter
```

#### `corsair/client.ts`

Client-side setup for using Corsair in your components.

```ts title="corsair/client.ts"
import { createCorsairClient, createCorsairHooks } from 'corsair'
import type { CorsairRouter } from '.'

const { typedClient } = createCorsairClient<CorsairRouter>({
  url: `${getBaseUrl()}${process.env.NEXT_PUBLIC_CORSAIR_API_ROUTE!}`,
})

const {
  useCorsairQuery,
  useCorsairMutation,
  corsairQuery,
  corsairMutation,
  types,
} = createCorsairHooks<CorsairRouter>(typedClient)

export { useCorsairQuery, useCorsairMutation, corsairQuery, corsairMutation }
```

#### `app/api/corsair/[...corsair]/route.ts`

Your API route handler that processes Corsair requests.

```ts title="app/api/corsair/[...corsair]/route.ts"
import { fetchRequestHandler } from 'corsair'
import { corsairRouter } from '@/corsair/index'
import { db } from '@/db'

const handler = async (req: Request) => {
  return fetchRequestHandler({
    endpoint: '/api/corsair',
    req,
    router: corsairRouter,
    createContext: () => ({
      userId: '123',
      db,
      schema: db._.schema!,
    }),
  })
}

export const GET = handler
export const POST = handler
```

#### Individual Query/Mutation Files

Files like `corsair/queries/get-all-albums.ts` or `corsair/mutations/create-album.ts` are generated by Corsair CLI but can be manually edited.

```ts title="corsair/queries/get-all-albums.ts"
import { z } from 'corsair'
import { procedure } from '../procedure'

export const getAllAlbums = procedure
  .input(z.object({}))
  .query(async ({ input, ctx }) => {
    const albums = await ctx.db.select().from(ctx.db._.fullSchema.albums)
    return albums
  })
```

### Corsair-Managed Files

<Callout type="warn" title="Do Not Edit Manually">
  These files are automatically generated and managed by Corsair. Manual changes
  will be overwritten when you run CLI commands.
</Callout>

#### `corsair/queries/index.ts`

Auto-generated file that exports all your queries. Updated automatically when you generate new queries.

```ts title="corsair/queries/index.ts"
export * from './get-all-albums'
export * from './get-album-by-id'
export * from './get-albums-by-artist-id'
```

#### `corsair/mutations/index.ts`

Auto-generated file that exports all your mutations. Updated automatically when you generate new mutations.

```ts title="corsair/mutations/index.ts"
export * from './create-album'
export * from './update-album'
export * from './delete-album'
```

## Database Schema

The database schema in `db/schema.ts` is your **source of truth**. When you modify it:

1. Run `pnpm corsair check` to see which queries/mutations are affected
2. Use `pnpm corsair fix` to automatically update them
3. Or use `pnpm corsair watch` during development for real-time updates

<Callout type="info" title="Schema-Aware">
  Corsair monitors your schema and can automatically regenerate affected queries
  and mutations when it changes. This keeps your codebase in sync with your database.
</Callout>

## File Naming Conventions

Corsair uses kebab-case for generated files:

- `"get all albums"` → `get-all-albums.ts`
- `"create post with tags"` → `create-post-with-tags.ts`
- `"update user profile"` → `update-user-profile.ts`

The procedure name inside the file uses camelCase:

```ts
export const getAllAlbums = procedure...
export const createPostWithTags = procedure...
export const updateUserProfile = procedure...
```

## Best Practices

1. **Use CLI for generation**: Always use `pnpm corsair query` or `pnpm corsair mutation` to create new operations
2. **Don't edit index.ts files**: Let Corsair manage the exports in `queries/index.ts` and `mutations/index.ts`
3. **Keep schema as source of truth**: Make schema changes first, then regenerate affected operations
4. **Version control**: Commit all generated files to git so your team has the same operations
5. **Manual edits allowed**: You can edit individual query/mutation files after generation if needed

