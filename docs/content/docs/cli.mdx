---
title: CLI
description: Command-line tools for code generation, validation, and migrations
---

import { Callout } from 'fumadocs-ui/components/callout'

<Callout type="info" title="Built for AI Agents">
  Corsair CLI is designed to work with AI coding agents like Claude Code and
  Cursor.
</Callout>

## Available Commands

### Initialize Project

Initialize a new Corsair project with all necessary files:

```bash
pnpm corsair init
```

This command guides you through an interactive setup that asks all questions upfront, then handles the rest automatically.

**Interactive Setup (all questions asked at the beginning):**

1. Which ORM are you using? (Drizzle / Prisma)
2. Which database are you using? (PostgreSQL / MySQL / SQLite)
3. Path to your database instance (default: `./db`)
4. Path for API route (default: `app/api/corsair/[...corsair]/route.ts`)
5. Path for Corsair folder (default: `corsair`)
6. Create `db/` folder with `db/index.ts`? (only if folder doesn't exist)
7. Create `db/schema.ts`? (only for Drizzle, if creating db folder)
8. Overwrite `corsair.config.ts`? (only if file already exists)
9. Install required dependencies?

After answering these questions, the setup runs automatically without further intervention.

**What gets created:**

- `db/index.ts` - Database connection setup (if db folder doesn't exist)
- `db/schema.ts` - Empty schema file (Drizzle only, if requested)
- `corsair.config.ts` - Main configuration file
- `corsair/` folder structure with all necessary files
- `app/api/corsair/[...corsair]/route.ts` - API endpoint

This is the first command you should run when setting up Corsair in your project.

**What gets installed:**

- Core: `corsair`, `@trpc/*`, `@tanstack/react-query`, `zod`, `superjson`, `dotenv`, `server-only`
- Drizzle: `drizzle-orm`, `drizzle-zod`, `drizzle-kit` (dev)
- Prisma: `@prisma/client`
- Database: `pg` and `@types/pg` (for PostgreSQL)

<Callout type="info" title="Minimal User Intervention">
  All questions are asked upfront at the beginning. After you answer the initial
  questions, the setup runs automatically without requiring further input. This
  allows you to step away while dependencies are installed and files are
  created.
</Callout>

<Callout type="info" title="Smart Defaults">
  If your `db/` folder already exists, the init command will skip creating
  database files to avoid overwriting your existing setup.
</Callout>

### Watch Mode

Start the interactive development UI with watch mode:

```bash
pnpm corsair watch
```

This starts an interactive UI that watches for schema changes and automatically
validates your queries and mutations. It provides real-time feedback on type safety
and schema compatibility.

### Generate

Generate types and validate your Corsair configuration:

```bash
pnpm corsair generate
```

This command generates TypeScript types for your queries and mutations based on
your schema and validates that all operations are properly typed.

### Check

Validate your queries and mutations without generating files:

```bash
pnpm corsair check
```

Runs validation checks on your Corsair operations to ensure they're correctly
structured and type-safe. Useful in CI/CD pipelines.

### Fix

Automatically fix common issues in your Corsair code:

```bash
pnpm corsair fix
```

Attempts to automatically fix common issues like missing exports, incorrect
imports, or simple type errors.

### Migrate

Run database migrations (integrates with your ORM's migration tool):

```bash
pnpm corsair migrate
```

For Drizzle projects, this runs `drizzle-kit push` to sync your
schema with your database.

## AI Agent Commands

<Callout type="warn" title="Important for AI Agents">
  Agents MUST use these CLI commands to generate queries and mutations. DO NOT
  write query/mutation code manually. The CLI ensures proper type safety,
  exports, and schema alignment.
</Callout>

Corsair has specialized commands designed for AI coding agents to generate
queries and mutations using natural language:

### Query Generation

Generate a new query with the `-n` (name) and `-i` (instructions) flags:

```bash
pnpm corsair query -n "get all albums by artist id" -i "return all albums in descending order (recent ones first)"
```

**More Query Examples:**

```bash
pnpm corsair query -n "getPostsWithAuthors" -i "fetch all posts with author details from posts and users tables"
```

```bash
pnpm corsair query -n "getCommentsByPostId" -i "get all comments for a specific post ID including author information"
```

```bash
pnpm corsair query -n "getUserProfile" -i "fetch user profile with their posts count and recent activity"
```

### Mutation Generation

Generate a new mutation:

```bash
pnpm corsair mutation -n "create album" -i "create a new album with validation"
```

**More Mutation Examples:**

```bash
pnpm corsair mutation -n "createPost" -i "create a new post with title, content, and author ID"
```

```bash
pnpm corsair mutation -n "updateComment" -i "update an existing comment's content by comment ID"
```

```bash
pnpm corsair mutation -n "deletePost" -i "delete a post and all its associated comments by post ID"
```

### Updating Existing Queries/Mutations

Use the `-u` flag to update an existing query or mutation:

```bash
pnpm corsair query -n "getPostsWithAuthors" -i "fetch all published posts with author details, sorted by created date" -u
```

```bash
pnpm corsair mutation -n "createAlbum" -i "create a new album with validation and send Slack notification" -u
```

### How It Works

When you run these commands, Corsair:

1. **Generates the file** in the appropriate folder (`corsair/queries/` or `corsair/mutations/`)
2. **Auto-exports** the procedure in the index.ts file
3. **Returns the path** where the query/mutation was generated
4. **Validates types** against your schema

<Callout type="info" title="Natural Language">
  These commands accept natural language descriptions and generate type-safe
  TypeScript code that matches your database schema. Be as specific as possible
  in your instructions for better results.
</Callout>

## Configuration

The CLI reads from your `corsair.config.ts` file. Make sure it's
properly configured before running CLI commands:

```ts title="corsair.config.ts"
import { type CorsairConfig } from 'corsair'
import { db } from './db'

export const config = {
  dbType: 'postgres',
  orm: 'drizzle',
  framework: 'nextjs',
  pathToCorsairFolder: './corsair',
  apiEndpoint: process.env.NEXT_PUBLIC_CORSAIR_API_ROUTE!,
  db: db,
  schema: db._.schema,
  connection: process.env.DATABASE_URL!,
} satisfies CorsairConfig<typeof db>
```

## CI/CD Integration

Add Corsair checks to your CI pipeline:

```yaml title=".github/workflows/ci.yml"
name: CI
on: [push, pull_request]

jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
      - run: npm install
      - run: npm run corsair check
      - run: npm run typecheck
```

<Callout type="warn" title="Schema-Aware Validation">
  When your database schema changes, Corsair will detect affected queries and
  mutations during the check command, preventing runtime errors.
</Callout>
