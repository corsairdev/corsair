---
title: Prisma
description: Integrate Corsair with Prisma ORM.
---

Prisma is a popular ORM for Node.js and TypeScript. Corsair's Prisma adapter provides full support for PostgreSQL.

## Installation

Make sure you have Prisma installed and configured. For more information, see the [Prisma Documentation](https://www.prisma.io/docs).

```ts title="corsair.ts"
import { createCorsair } from "corsair";
import { prismaPostgresAdapter } from "corsair/adapters/prisma";
import { prisma } from "./prisma";

export const corsair = createCorsair({
    database: prismaPostgresAdapter(prisma),
    plugins: [...],
});
```

## Configuration

The Prisma adapter accepts the following options:

| Option | Type | Description |
|--------|------|-------------|
| `adapterId` | `string` | Custom adapter identifier |
| `models` | `object` | Custom model name mappings |

## Schema Setup

Add the Corsair tables to your Prisma schema:

```prisma title="prisma/schema.prisma"
model corsair_providers {
    id         String   @id
    config     Json?
    created_at DateTime @default(now())
    updated_at DateTime @updatedAt
}

model corsair_connections {
    id          String   @id @default(uuid())
    tenant_id   String
    provider_id String
    config      Json?
    created_at  DateTime @default(now())
    updated_at  DateTime @updatedAt
}

model corsair_resources {
    id          String   @id @default(uuid())
    tenant_id   String
    resource_id String
    resource    String
    service     String
    version     String?
    data        Json?
    created_at  DateTime @default(now())
    updated_at  DateTime @updatedAt
}

model corsair_events {
    id          String   @id @default(uuid())
    tenant_id   String
    resource_id String?
    event_type  String
    data        Json?
    created_at  DateTime @default(now())
}
```

After updating your schema, run migrations:

```bash
npx prisma migrate dev
```

## Custom Model Names

If your Prisma models use different names, map them in the config:

```ts title="corsair.ts"
import { prismaPostgresAdapter } from "corsair/adapters/prisma";

export const corsair = createCorsair({
    database: prismaPostgresAdapter(prisma, {
        models: {
            corsair_resources: "CorsairResource",
            corsair_credentials: "CorsairCredential",
        },
    }),
    plugins: [...],
});
```

## Transactions

The Prisma adapter supports interactive transactions:

```ts title="example.ts"
await corsair.slack.db.messages.transaction(async (trx) => {
    await trx.upsertByEntityId("msg_1", { text: "Hello" });
    await trx.upsertByEntityId("msg_2", { text: "World" });
});
```

## Full Example

```ts title="corsair.ts"
import { createCorsair } from "corsair";
import { prismaPostgresAdapter } from "corsair/adapters/prisma";
import { slack, linear } from "corsair/plugins";
import { PrismaClient } from "@prisma/client";

const prisma = new PrismaClient();

export const corsair = createCorsair({
    multiTenancy: true,
    database: prismaPostgresAdapter(prisma),
    plugins: [
        slack({
            authType: "api_key",
            credentials: { botToken: process.env.SLACK_BOT_TOKEN },
        }),
        linear({
            authType: "api_key",
            credentials: { apiKey: process.env.LINEAR_API_KEY },
        }),
    ],
});
```

## Prisma Client Setup

```ts title="prisma.ts"
import { PrismaClient } from "@prisma/client";

const globalForPrisma = globalThis as unknown as {
    prisma: PrismaClient | undefined;
};

export const prisma = globalForPrisma.prisma ?? new PrismaClient();

if (process.env.NODE_ENV !== "production") {
    globalForPrisma.prisma = prisma;
}
```

