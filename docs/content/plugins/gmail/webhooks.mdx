---
title: Gmail Webhooks
description: All available Gmail webhook events and how to handle them.
---

The Gmail plugin automatically handles incoming webhooks from Gmail via Google Pub/Sub. Configure Gmail Watch to send notifications to your Pub/Sub topic, and the plugin will automatically process events and update your database.

<Callout type="info">
**New to Corsair?** Learn about core concepts like [webhooks](/concepts/webhooks), [hooks](/concepts/hooks), and [multi-tenancy](/concepts/multi-tenancy) before setting up webhook handlers.
</Callout>

<Callout>
**Full Implementation:** For the complete, up-to-date list of all webhook events and their implementations, see the [Gmail plugin source code](https://github.com/corsairdev/corsair/tree/main/packages/corsair/plugins/gmail) on GitHub.
</Callout>

## Setup

Gmail webhooks use Google Pub/Sub. Configure your webhook endpoint to handle Pub/Sub notifications:

```ts title="app/api/webhook/route.ts"
import { processWebhook } from "corsair";
import { corsair } from "@/server/corsair";

export async function POST(request: Request) {
    const headers = Object.fromEntries(request.headers);
    const body = await request.json();
    
    const result = await processWebhook(corsair, headers, body);
    return result.response;
}
```

Set up a Pub/Sub push subscription pointing to your webhook endpoint:

```
https://your-domain.com/api/webhook
```

For multi-tenancy, include the tenant ID:

```
https://your-domain.com/api/webhook?tenantId=tenant-123
```

## Available Webhooks

### messageReceived

`messages.messageReceived`

**Event Type:** Message Received

Fires when a new email message is received.

**When it fires:** A new email arrives in the mailbox

**Payload Structure:**

```ts
{
    messageId: string;
    threadId: string;
    labelIds: string[];
    // ... message data
}
```

**Example Usage:**

```ts title="corsair.ts"
gmail({
    webhookHooks: {
        messageReceived: {
            after: async (ctx, result) => {
                const message = result.data;
                console.log(`New email received: ${message.subject}`);
                
                await processNewEmail(message);
            },
        },
    },
})
```

---

### messageDeleted

`messages.messageDeleted`

**Event Type:** Message Deleted

Fires when a message is deleted.

**When it fires:** A message is permanently deleted

**Payload Structure:**

```ts
{
    messageId: string;
}
```

**Example Usage:**

```ts title="corsair.ts"
gmail({
    webhookHooks: {
        messageDeleted: {
            after: async (ctx, result) => {
                console.log(`Message deleted: ${result.data.messageId}`);
            },
        },
    },
})
```

---

### messageLabelChanged

`messages.messageLabelChanged`

**Event Type:** Message Label Changed

Fires when labels are added or removed from a message.

**When it fires:** Labels are modified on a message

**Payload Structure:**

```ts
{
    messageId: string;
    addedLabelIds: string[];
    removedLabelIds: string[];
}
```

**Example Usage:**

```ts title="corsair.ts"
gmail({
    webhookHooks: {
        messageLabelChanged: {
            after: async (ctx, result) => {
                const { messageId, addedLabelIds, removedLabelIds } = result.data;
                
                if (addedLabelIds.includes("INBOX")) {
                    console.log(`Message ${messageId} moved to inbox`);
                }
            },
        },
    },
})
```

---

## Configuring Gmail Watch

To receive webhook events, you need to set up Gmail Watch:

1. Go to [Google Cloud Console](https://console.cloud.google.com)
2. Create a Pub/Sub topic
3. Configure Gmail Watch API to send notifications to your Pub/Sub topic
4. Set up a Pub/Sub push subscription pointing to your webhook endpoint

Gmail webhooks use Pub/Sub, so no signing secret is needed. The webhook will receive Pub/Sub notifications with base64 encoded message data.

See the [Gmail API documentation](https://developers.google.com/gmail/api/guides/push) for more information.
